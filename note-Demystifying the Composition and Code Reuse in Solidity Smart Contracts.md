# **Demystifying the Composition and Code Reuse in Solidity Smart** Contracts

## 一、摘要

外部资源，例如第三方包被广泛使用。虽然方便但为下游应用造成安全风险。以前的研究只关注代码克隆，没有考虑如何引入外部组件，因此智能契约的组成及其特征仍然令人困惑。composition of smart contrast and their characteristic

本文对超过35万个可靠性智能契约solid smart contrast进行实证研究，以揭示它们的组成部分，进行代码重用分析，并识别流行的开发模式。

## 二、背景

**智能合约**是指**共享相同地址的代码块**

**分包合约**是指**合约级别的代码块**，包含以下四种：

1、接口**interface**：定义标准或协议，不包括方法实现

2、摘要**abstract**：定义基本结构，包括一些方法实现

3、合约**contract**：完整的可执行的分包合约

4、库**library**：不需要存储，为常规操作提供可重用的代码块

+++

1、**智能合约**是建立在区块链技术之上的一种特殊类型的程序，用于自动化、验证和强制执行双方之间的协议谈判。

2、随着智能合约的发展，智能合约越来越**依赖第三方建立的分包合约**（如合约级代码块），以避免重复造轮子，提高开发速度。

3、大多数现有的工作只关注于单一粒度的智能合约，如分包合约或函数，而忽略了在开发过程中是如何引入这些元素的。

**工作流程**：

1、从以太扫描[7]收集了超过35万份智能合约的源代码。

2、从收集的合约的导入报表中汇编了来自NPM和GitHub Repos的353个第三方包的列表。

3、验证这些合约（有元数据，非空），并使用ANTLR-4将它们解析为JSON文件。通过进行合约级代码克隆检测（MD5散列）来检查并过滤掉没有修改或轻微修改的合约。经过这一过程，获得296236份不同的合约供进一步研究。

> 以上三步为数据收集

4、根据合约的起源以及如何引入合约，将合约分解为各种分包合约。

对于自开发的子合约，研究函数级代码重用，总结了通常重用的函数和需要自定义的函数。

对于外部分包合约，研究经常重用的分包合约和克隆的使用情况。

**实验发现**：

1、超过80%的**分包合约来自外部来源**。最大的已确定的外部来源是NPM，占总外部分包合约的72%以上。

2、尽管稳固性允许通过在导入语句中指定包名所需的分包合约来包含NPM依赖关系，但仍有超过56%的克隆分包合约来自NPM包，这表明**依赖关系管理存在混乱**。

3、**函数的代码重用**是常见的。

4、分包**合约类型使用不一致**。

5、确定了61中**流行的开发模式**，其中最多的方式是令牌创建，虽然降低了开发成本但是存在安全隐患。

## 三、实验

首先，将合约分解为分包合约，确定它们的起源和引入方法。

然后，分别对来自不同来源（即自我开发或外部）的分包合约进行深入的代码重用分析，并提供对其个体特征的见解。

最后，为了更好地理解合约的组成和代码重用，我们提取了常用的开发模式。

### RQ1：合约克隆分解

智能合约引用分包合约的**常见来源和方法**是什么？确定合约的组成部分，以及各种引入方法的使用情况。

> **对标：apk引用so的方法以及so的来源有哪些？这些方法的使用情况统计分析。**

**合约的组成成分：**

重用合约中有80%和令牌token有关，其中ERC20 token占据66.10%。大规模重用合约主要来源于使用生成器generator，且90.17%的合约来源于同一团队。

> **对标：apk中引用so主要适用于什么场景，比例多少，so开发团队是否高度集中？**

**分包合约引用方式：**

1、导入：导入语句引用外部源，如NPM包或URL。

2、克隆：例如早期部署的智能合约和第三方包。**最多，占60.95%**

3、自开发：**最少，占不到20%。**

分包合约来源：

**分析了导入和克隆两种外部分包合约来源：**

1、导入语句导入NPM包名称

2、导入URL，即GitHub Repos

3、克隆第三方软件包

> **对标：apk中引用so的方式有哪些？目前看好像都是克隆**
>
> **克隆so的来源有哪些？现在已经收集的是Ubuntu，debian，maven，GitHub**

### RQ2 自开发分包合约分析

自开发分包合约的特征是什么？了解自开发分包合约中代码重用的程度和特征。

1、功能级克隆检测，以确定合同开发中代码重用的程度

2、分析重用的函数类型是实现的功能

> **对标：apk引用so时可达的函数？这些引用的函数主要实现什么功能？**

### RQ3 外部分包合约的分析

外部分包合约的特征是什么？分析顶级重用的外部分包合同和第三方包的特点和常见应用，以便合约开发和第三方包管理。

1、对外部分包合约**类型**分析

2、对外部分包合约**频率**分析：知名库的使用比不知名库频繁

3、对第三方软件包的**概述**

> 对标：apk引用so时，so可以分为哪些种类，不同种类so的使用频率如何？使用频率和供应商之间的关系

### RQ4 开发模式

在智能合约开发中的常用模式是什么？

确定了61种开发模式。具体来说，令牌创建、代理契约和令牌交换占标识模式的68.75%、20.31%和10.34% ，这表明这些领域的高度标准化。