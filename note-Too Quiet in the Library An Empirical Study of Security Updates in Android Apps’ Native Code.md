# Too Quiet in the Library: An Empirical Study of Security Updates in Android Apps’ Native Code

## 一、摘要

third-party native library第三方本地库

jave native interface JAVA本机接口

Android Native Development Kit安卓本机开发工具包

本机代码通过Java本机接口或Android本机开发工具包直接从应用程序中执行。

**现状**是开发者可能持续使用具有未打补丁的安全漏洞的过时本机库。

**现实实验**是研究了2013年9月至2020年5月期间谷歌Play上最流行的200个免费应用程序的本地库的安全更新。

**难点**是识别库和他们的版本，因为开发者总是对他们进行重命名或修改操作。

**模型**是LibRARIAN，该方法基于我们新颖的相似性度量bin2 sim，可以准确地识别安卓应用程序中的原生库（native library）及其版本。LibRARIAN利用了从库的元数据（metadata）中提取的不同特性，并识别只读部分中的字符串。

**实验结果**是（26.5%）的流行应用版本包含已知cve，其中14个仍然存在漏洞。应用开发者的更新速度比库开发者慢10倍左右。

本文数据集公开提供用于后续研究。

## 二、简介

LibRARIAN可以识别使用的库以及库的版本，它新建了一种相似度评分标准bin^2sim，利用六种特征进行识别。

**之前**的工作都是在**功能级别**上识别二进制文件之间的语义相似性，主要用于识别恶意软件；**LibRARIAN**是一种基于语法的工具，计算两个良性二进制文件之间的相似性，属**文件级别**。

## 三、LibRARIAN

（1）提取区分库的**主要、次要版本和补丁版本的特征**（major，minor，patch），无论底层架构和编译环境如何这些特征在跨平台的情况下都是**稳定**的。

（2）使用新的相似性度量bin^2sim，将这些特征和ground-truth数据集中的特征进行比较。

（3）版本标识字符串

### 1、特征向量提取

<u>**（1）方法：**</u>

**在二进制ELF文件（可执行可链接文件）中提取特征+在库的不同二进制部分提取特征。**

> 安卓应用中所有共享库都会被编译为ELF文件，与其他对象文件相同，ELF文件包含一个符号表，表上标注了外部可见标识符，例如函数名、全局符号、本地符号和导入符号。
>
> **符号表**在加载和链接阶段由**二进制分析工具**（例如objdump、readelf、nm、pwntools或angr [36]）分析**推断关于二进制文件的信息**。

为了区别库及其版本，我们定义了一个包含**六个**库和版本固有的**特征**的**特征集**。

（1）其中，**五个特征**用于表示**ELF元数据**，这五个数据用于计算两个二进制文件的相似性得分，因此被称为**元数据特征**。

> 导入函数，导出函数，导入全局数据，导出全局数据，库依赖关系

（2）**版本标识字符串** ，即从**ELF obiect的.rodata部分**中提取的字符串。该特征补充了第一组特征的相似性得分，用于**验证版本的正确性**，或当ground-truth数据集和现有的二进制文件的相似性较低时作为**fallback**。

> fallback：当相似性较低时替代五个元数据特征

不使用代码特性（控制流、数据流），因为他们很不稳定，在不同编译器和体系结构间会发生变化。

**二进制相似性匹配是一个开放性难题，现有的算法虽然精度有很大的提高，但是计算成本很高。**

**<u>（2）具体实现：</u>**

我们通过ground-truth数据集中的二进制文件构建了一个启发式数据集：

在特征处理过程中提取.rodata部分中的数据，利用**正则匹配**搜索每个库中唯一包含版本信息的字符串。（正则匹配表达式见表二）

利用**angr的ELF解析器**提取ELF文件中的元数据特征。

本实现是**独立于平台**的，涵盖了x86-64、x86、ARM和ARM64二进制文件，为了适应架构差异：首先，我们去除特征向量中的架构噪声（例如，只在一个架构中使用的符号）；第二，如果有的话，我们为不同的架构收集二进制文件。

特征提取将所有信息作为一个字典编译成一个JSON文件，包含上述每个特性的字符串数组+用于标识库和体系结构的附加元数据。

### 2、相似性对比

给定两个二进制文件b1和b2与各自的特征向量FV1和FV2（ELF表中的五个元数据），


$$
% MathType!MTEF!2!1!+-
% feaahqart1ev3aaatCvAUfeBSjuyZL2yd9gzLbvyNv2CaerbuLwBLn
% hiov2DGi1BTfMBaeXatLxBI9gBaerbd9wDYLwzYbItLDharqqtubsr
% 4rNCHbWexLMBbXgBd9gzLbvyNv2CaeHbl7mZLdGeaGqiVu0Je9sqqr
% pepC0xbbL8F4rqqrFfpeea0xe9Lq-Jc9vqaqpepm0xbba9pwe9Q8fs
% 0-yqaqpepae9pg0FirpepeKkFr0xfr-xfr-xb9adbaqaaeGaciGaai
% aabeqaamaabaabauaakeaacaWGIbGaamyAaiaad6gadaahaaWcbeqa
% aiaaikdaaaGccaWGZbGaamyAaiaad2gacaGGOaGaamOraiaadAfada
% WgaaWcbaGaaGymaaqabaGccaGGSaGaamOraiaadAfadaWgaaWcbaGa
% aGOmaaqabaGccaGGPaGaeyypa0ZaaSaaaeaacaGG8bGaamOraiaadA
% fadaWgaaWcbaGaaGymaaqabaGccqGHPiYXcaWGgbGaamOvamaaBaaa
% leaacaaIYaaabeaakiaacYhaaeaacaGG8bGaamOraiaadAfadaWgaa
% WcbaGaaGymaaqabaGccqGHQicYcaWGgbGaamOvamaaBaaaleaacaaI
% YaaabeaakiaacYhaaaGaeyicI4Saai4waiaaicdacaGGSaGaaGymai
% aac2faaaa!6504!
bi{n^2}sim(F{V_1},F{V_2}) = \frac{{|F{V_1} \cap F{V_2}|}}{{|F{V_1} \cup F{V_2}|}} \in [0,1]
$$
共同特征数量/独特特征数量

越接近1说明两个二进制文件的相似性越高，过滤噪声十分重要，阈值设置为0.85。

如果匹配结果超过多个已知二进制文件的阈值，则LibTATIAN将通过使用它们（已知的二进制文件和未知的二进制文件）的**哈希代码**来确定未知的二进制文件的版本。

如果匹配分数较低，可能是因为开发者在使用第三方库时删除（多）或增加了一些功能。

### 3、版本识别字符串Version Identification Strings

对于LibRARIAN报告低相似性分数的库，使用唯一标识库的字符串来扩展特性。这些字符串通常是版本字符串version strings。（根据表二中的正则匹配启发式提取）如果相似性得分高，则用于验证正确性；如果相似性得分低，则用于识别准确的库版本。

由于库中包含大量经常变化的只读字符串，因此我们不能直接使用这些数据作为特性（由于低重叠导致低相似性）。通过处理来自ground-truth数据集的.rodata并对数据进行聚类，我们提取了通用的版本标识符和版本字符串。然后，将它们转换为正则表达式，从而匹配不同库的版本。

## 四、实验评价

数据收集：

谷歌Play在几年来的前**200款应用，共7678个实例**，每个实例是某个应用的某个版本。

我们从**AndroZoo** 上跟踪这些应用程序的版本历史，这是一个拥有超过1100万款安卓应用程序的大型存储库。

我们的存储库包含应用程序元数据，包括应用程序名称、发布日期和本机二进制文件Native binaries。

### 1、LibRARIAN的准确性和有效性

（1）将其准确性与OSSPolice进行比较，这是识别Android应用程序原生二进制文件版本的最新技术。

> ground-truth数据集包含了从F-Droid 收集的104个应用程序中提取的475个二进制文件（其中67个是唯一的）。
>
> 识别率提高了12%

（2）在一个OSSPolice无法应用的更大的数据集上评估LibRARIAN。

> 手动定位库的预先构建的二进制文件（未知版本）+从官方网站、GitHub和Debian存储库中获得相应已知版本的二进制文件。
>
> 具有已知库和版本的二进制文件包含46个不同的库，共有904个版本，平均每个库有19个版本。
>
> 识别准确率91.15%

（3）评估LibRARIAN的特性类型在识别本机库版本方面的有效性。

> 37.42%仅通过版本标识字符串，45.29%元数据，剩余的两种都可用。
>
> 导出函数和导入函数占元数据功能有效性的绝大多数，分别占58.25%和32.98%。

### 2、过时库的流行度

OpenSSL、OpenCV、GIFLib 、XML，这四个库的影响最大

### 3、修补程序的相应时间





